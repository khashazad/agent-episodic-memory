# Build on top of the existing pre-built MineRL image
# This avoids architecture issues when building on Apple Silicon
FROM strangeman44/minerl-env-server:latest

# Copy the multi-environment server script (replaces the single-env version)
COPY multi_env_server.py /app/multi_env_server.py

# Expose Flask port
EXPOSE 5000

# Environment variables for configuration (can be overridden at runtime)
ENV DISPLAY=:99
ENV INACTIVITY_TIMEOUT=300
ENV CLEANUP_INTERVAL=60

# Run the multi-env server
CMD ["bash", "-lc", "Xvfb :99 -screen 0 1920x1080x24 & sleep 3; conda run --no-capture-output -n minerl python /app/multi_env_server.py"]
